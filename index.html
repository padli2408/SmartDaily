<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartDaily - Asisten Harian Pintar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body {
      background-color: #f4f6f8;
    }
    .mood-emoji {
      font-size: 2rem;
      cursor: pointer;
    }
    .mood-selected {
      border: 2px solid #007bff;
      border-radius: 50%;
    }
    .schedule-time {
      font-size: 0.9rem;
      color: #666;
    }
  </style>
</head>
<body onload="loadData()">
  <div class="container py-4">
    <h1 class="mb-4 text-center">SmartDaily</h1><!-- Google Login -->
<div class="mb-3 text-center">
  <button class="btn btn-outline-primary" onclick="handleAuthClick()">Login Google</button>
  <button class="btn btn-outline-danger" onclick="handleSignoutClick()">Logout</button>
</div>

<!-- To-Do List Input -->
<div class="card mb-4">
  <div class="card-header">To-Do List + Penjadwalan Otomatis</div>
  <div class="card-body">
    <div class="input-group mb-3">
      <input type="text" id="taskInput" class="form-control" placeholder="Tambahkan tugas baru...">
      <button class="btn btn-primary" onclick="addTask()">Tambah</button>
    </div>
    <ul id="taskList" class="list-group"></ul>
    <button class="btn btn-success mt-3" onclick="autoSchedule()">Auto-Jadwalkan</button>
  </div>
</div>

<!-- Mood Tracker -->
<div class="card mb-4">
  <div class="card-header">Mood Tracker</div>
  <div class="card-body">
    <div class="d-flex justify-content-around">
      <span class="mood-emoji" onclick="selectMood('üòä')">üòä</span>
      <span class="mood-emoji" onclick="selectMood('üòê')">üòê</span>
      <span class="mood-emoji" onclick="selectMood('üò¢')">üò¢</span>
      <span class="mood-emoji" onclick="selectMood('üò†')">üò†</span>
    </div>
    <p class="mt-3">Mood saat ini: <span id="selectedMood">-</span></p>
    <p id="moodSuggestion" class="text-muted"></p>
  </div>
</div>

  </div>  <script>
    const CLIENT_ID = 'GANTI_DENGAN_CLIENT_ID_ANDA';
    const SCOPES = 'https://www.googleapis.com/auth/calendar.events';
    let tokenClient;

    let gapiInited = false;
    let gisInited = false;

    function gapiLoaded() {
      gapi.load('client', initializeGapiClient);
    }

    async function initializeGapiClient() {
      await gapi.client.init({
        apiKey: '',
        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
      });
      gapiInited = true;
    }

    window.onload = () => {
      loadData();
      gapiLoaded();
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: (tokenResponse) => {
          gapi.client.setToken(tokenResponse);
        },
      });
    };

    function handleAuthClick() {
      tokenClient.requestAccessToken();
    }

    function handleSignoutClick() {
      gapi.client.setToken('');
      alert("Logout berhasil");
    }

    async function createGoogleCalendarEvent(summary, startTime) {
      const endTime = new Date(startTime.getTime() + 60 * 60 * 1000);
      const event = {
        summary: summary,
        start: { dateTime: startTime.toISOString() },
        end: { dateTime: endTime.toISOString() },
      };

      try {
        await gapi.client.calendar.events.insert({
          calendarId: 'primary',
          resource: event,
        });
        console.log("Event berhasil ditambahkan ke Google Calendar");
      } catch (err) {
        console.error("Gagal menambahkan ke Calendar:", err);
      }
    }

    let taskCounter = 0;
    if ("Notification" in window && Notification.permission !== "granted") {
      Notification.requestPermission();
    }

    function addTask() {
      const input = document.getElementById("taskInput");
      const taskText = input.value.trim();
      if (taskText === "") return;

      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-center task-item";
      li.setAttribute("data-id", taskCounter);
      li.innerHTML = `
        <div>
          <strong>${taskText}</strong>
          <div class="schedule-time" id="time-${taskCounter}">Belum dijadwalkan</div>
        </div>
        <button class="btn btn-sm btn-danger" onclick="removeTask(this)">Hapus</button>
      `;
      document.getElementById("taskList").appendChild(li);
      saveTaskToStorage(taskCounter, taskText);
      input.value = "";
      taskCounter++;
    }

    function removeTask(button) {
      const li = button.parentElement;
      const taskId = li.getAttribute("data-id");
      li.remove();
      localStorage.removeItem(`task-${taskId}`);
    }

    function autoSchedule() {
      const tasks = document.querySelectorAll(".task-item");
      const startHour = 9;
      const interval = 1;
      let currentTime = new Date();
      currentTime.setHours(startHour, 0, 0, 0);

      tasks.forEach((task, index) => {
        const taskTime = new Date(currentTime.getTime() + index * interval * 60 * 60 * 1000);
        const timeString = `${taskTime.getHours().toString().padStart(2, '0')}:00`;
        const taskId = task.getAttribute("data-id");
        document.getElementById(`time-${taskId}`).textContent = `Dijadwalkan: ${timeString}`;

        const now = new Date();
        const delay = taskTime.getTime() - now.getTime();
        if (delay > 0) {
          setTimeout(() => {
            if (Notification.permission === "granted") {
              new Notification("Waktu Tugas!", {
                body: `Saatnya mengerjakan: ${task.textContent.trim()}`
              });
            }
          }, delay);
        }

        const taskText = task.querySelector("strong").textContent;
        createGoogleCalendarEvent(taskText, taskTime);
      });
    }

    function selectMood(mood) {
      document.getElementById("selectedMood").textContent = mood;
      const suggestions = {
        "üòä": "Lanjutkan produktivitas! Coba jalan santai atau journaling.",
        "üòê": "Coba dengarkan musik atau tarik napas dalam.",
        "üò¢": "Istirahat sebentar. Mungkin nonton video lucu?",
        "üò†": "Coba meditasi singkat atau olahraga ringan."
      };
      document.getElementById("moodSuggestion").textContent = suggestions[mood];

      document.querySelectorAll('.mood-emoji').forEach(el => el.classList.remove('mood-selected'));
      event.target.classList.add('mood-selected');

      localStorage.setItem("todayMood", mood);
    }

    function saveTaskToStorage(id, text) {
      localStorage.setItem(`task-${id}`, text);
      localStorage.setItem("taskCounter", taskCounter);
    }

    function loadData() {
      const storedCounter = localStorage.getItem("taskCounter");
      taskCounter = storedCounter ? parseInt(storedCounter) : 0;

      for (let i = 0; i < taskCounter; i++) {
        const text = localStorage.getItem(`task-${i}`);
        if (text) {
          const li = document.createElement("li");
          li.className = "list-group-item d-flex justify-content-between align-items-center task-item";
          li.setAttribute("data-id", i);
          li.innerHTML = `
            <div>
              <strong>${text}</strong>
              <div class="schedule-time" id="time-${i}">Belum dijadwalkan</div>
            </div>
            <button class="btn btn-sm btn-danger" onclick="removeTask(this)">Hapus</button>
          `;
          document.getElementById("taskList").appendChild(li);
        }
      }

      const savedMood = localStorage.getItem("todayMood");
      if (savedMood) {
        selectMood(savedMood);
      }
    }
  </script></body>
</html>